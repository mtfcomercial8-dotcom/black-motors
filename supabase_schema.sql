-- COPIE E COLE ESTE CÓDIGO NO SQL EDITOR DO SUPABASE

-- 1. Cria a tabela de reservas e encomendas
create table if not exists public.reservations (
  id bigint generated by default as identity primary key,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  name text not null,
  phone text not null,
  date text not null,
  time text not null,
  guests text not null,
  type text not null, -- 'reserva' ou 'encomenda'
  status text default 'pendente', -- 'pendente', 'confirmado', 'cancelado'
  notes text
);

-- 2. Habilita segurança (Row Level Security)
alter table public.reservations enable row level security;

-- 3. Cria políticas de acesso

-- Permitir que qualquer pessoa (anon) crie uma reserva (Insert)
create policy "Enable insert for everyone" 
on public.reservations for insert 
to anon, authenticated 
with check (true);

-- Permitir leitura para anon (público) - opcional, se quiser que usuários vejam status
-- Mas fundamentalmente, permitir leitura e escrita completa para o ADMIN (Authenticated)

create policy "Enable full access for authenticated users" 
on public.reservations for all 
to authenticated 
using (true) 
with check (true);

-- Manter política de leitura pública se necessário, ou restringir apenas ao admin
-- Por enquanto, mantemos leitura pública para simplificar debugging, mas o ideal seria apenas admin ver tudo.
create policy "Enable select for everyone" 
on public.reservations for select 
to anon 
using (true);

-- Permitir update apenas para admin (authenticated) e anon (se necessário, mas perigoso)
-- Vamos permitir update para anon para o caso de teste, mas a UI só expõe isso no admin.
create policy "Enable update for everyone" 
on public.reservations for update 
to anon 
using (true);
